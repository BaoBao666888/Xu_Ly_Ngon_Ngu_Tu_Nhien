<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NLP WebApp Pro üåê</title>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
    <h1>NLP WebApp Pro üåê</h1>
    <div class="tabs">
        <button class="tab-btn active" onclick="showTab('input', this)">üì• Nh·∫≠p li·ªáu</button>
        <button class="tab-btn" onclick="showTab('augment', this)">üîÅ TƒÉng c∆∞·ªùng</button>
        <button class="tab-btn" onclick="showTab('preprocess', this)">üßπ X·ª≠ l√Ω</button>
        <button class="tab-btn" onclick="showTab('vector', this)">üìä Bi·ªÉu di·ªÖn</button>
        <button class="tab-btn" onclick="showTab('train', this)">üß† Train</button>
        <button class="tab-btn" onclick="showTab('recommend', this)">üéØ G·ª£i √Ω s·∫£n ph·∫©m</button>
        <button class="tab-btn" onclick="showTab('chatbot', this)">üí¨ Chatbot</button>
    </div>

    <!-- Tab: Nh·∫≠p li·ªáu -->
    <div id="input" class="tab-content">
        <h2>üì• Nh·∫≠p li·ªáu</h2>
        <div class="input-section">
            <h4>VƒÉn b·∫£n th·ªß c√¥ng:</h4>
            <textarea id="manualText" rows="5" cols="80" placeholder="Nh·∫≠p vƒÉn b·∫£n..."></textarea>
        </div>
        <div class="input-section">
            <h4>T·∫£i file TXT:</h4>
            <input type="file" id="fileTxt" accept=".txt" onchange="loadTxtFile(event)"><br><br>
        </div>
        <div class="input-section">
            <h4>T·∫£i file CSV:</h4>
            <input type="file" id="csvInput" accept=".csv">
            <button onclick="withLoading('loader-csv', uploadCSV)">T·∫£i CSV</button>
            <div id="loader-csv" class="loader"></div>
            <div id="column-selection" style="display:none; margin-top:10px;">
                <label>C·ªôt VƒÉn b·∫£n:</label>
                <select id="text-column"></select>
                <label>C·ªôt Nh√£n:</label>
                <select id="label-column"></select>
                <button onclick="selectCSVColumns()">Ch·ªçn c·ªôt & Ti·∫øp t·ª•c</button>
            </div>
            <div id="csv-sample-display" style="margin-top:10px;"></div>
        </div>
        <div class="input-section">
            <h4>C√†o d·ªØ li·ªáu t·ª´ Web:</h4>
            <input type="text" id="scrape-url" placeholder="Nh·∫≠p URL..." style="width: 60%;">
            <button onclick="withLoading('loader-scrape', doScrape)">C√†o Web</button>
            <div id="loader-scrape" class="loader"></div>
            <p><em>(VƒÉn b·∫£n c√†o ƒë∆∞·ª£c s·∫Ω ƒë∆∞·ª£c th√™m v√†o √¥ "VƒÉn b·∫£n th·ªß c√¥ng")</em></p>
        </div>
    </div>

    <!-- Tab: TƒÉng c∆∞·ªùng -->
    <div id="augment" class="tab-content" style="display:none;">
        <h2>üîÅ TƒÉng c∆∞·ªùng d·ªØ li·ªáu</h2>
        <p><em>S·ª≠ d·ª•ng vƒÉn b·∫£n t·ª´ tab "Nh·∫≠p li·ªáu" ho·∫∑c d·ªØ li·ªáu CSV ƒë√£ ch·ªçn.</em></p>
        <label><input type="checkbox" value="back_translation"> D·ªãch ng∆∞·ª£c</label>
        <label><input type="checkbox" value="synonym_replacement"> ƒê·ªìng nghƒ©a</label>
        <label><input type="checkbox" value="random_insertion"> Th√™m t·ª´</label>
        <label><input type="checkbox" value="random_swap"> ƒê·ªïi ch·ªó</label>
        <label><input type="checkbox" value="random_deletion"> Xo√° t·ª´</label>
        <label><input type="checkbox" value="entity_replacement"> Th·ª±c th·ªÉ</label>
        <label><input type="checkbox" value="add_noise"> Nhi·ªÖu k√Ω t·ª±</label><br><br>
        <button onclick="withLoading('loader-augment-manual', applyAugmentManual)">TƒÉng c∆∞·ªùng Manual</button>
        <button onclick="withLoading('loader-augment-csv', applyAugmentCSV)">TƒÉng c∆∞·ªùng CSV</button>
        <div id="loader-augment-manual" class="loader"></div>
        <div id="loader-augment-csv" class="loader"></div>
        <div id="augmented-result" class="result-table-container" style="margin-top:10px;"></div>
    </div>

    <!-- Tab: Ti·ªÅn x·ª≠ l√Ω -->
    <div id="preprocess" class="tab-content" style="display:none;">
        <h2>üßπ Ti·ªÅn x·ª≠ l√Ω</h2>
        <p><em>S·ª≠ d·ª•ng vƒÉn b·∫£n t·ª´ tab "Nh·∫≠p li·ªáu" ho·∫∑c d·ªØ li·ªáu CSV ƒë√£ ch·ªçn.</em></p>
        <label><input type="checkbox" value="sentence_tokenization"> Sentence tokenization</label>
        <label><input type="checkbox" value="word_tokenization"> Word tokenization</label>
        <label><input type="checkbox" value="remove_stopwords"> Xo√° stop words</label>
        <label><input type="checkbox" value="rm_pun"> Xo√° d·∫•u c√¢u</label>
        <label><input type="checkbox" value="lowercasing"> Vi·∫øt th∆∞·ªùng</label>
        <label><input type="checkbox" value="fix_abbreviations"> S·ª≠a vi·∫øt t·∫Øt</label><br><br>
        <button onclick="withLoading('loader-preprocess-manual', applyPreprocessManual)">X·ª≠ l√Ω Manual</button>
        <button onclick="withLoading('loader-preprocess-csv', applyPreprocessCSV)">X·ª≠ l√Ω CSV</button>
        <div id="loader-preprocess-manual" class="loader"></div>
        <div id="loader-preprocess-csv" class="loader"></div>
        <div id="preprocess-result-container" class="result-table-container">
             <pre id="preprocess-result"></pre>
        </div>
    </div>

    <!-- Tab: Bi·ªÉu di·ªÖn d·ªØ li·ªáu -->
    <div id="vector" class="tab-content" style="display:none;">
        <h2>üìä Bi·ªÉu di·ªÖn d·ªØ li·ªáu</h2>
        <!-- THAY ƒê·ªîI ·ªû ƒê√ÇY: b·ªè "multiple" -->
        <p><strong>Ch·ªçn ph∆∞∆°ng ph√°p vector h√≥a:</strong> (S·∫Ω ƒë∆∞·ª£c d√πng ƒë·ªÉ Train n·∫øu l√† d·ªØ li·ªáu CSV)</p>
        <select id="vector-method">
            <option value="tfidf" selected>TF-IDF</option>
            <option value="bow">BoW</option>
            <option value="one_hot">One-hot</option>
            <option value="ngram">N-Gram</option>
            <option value="word2vec">Word2Vec</option>
            <option value="fasttext">FastText</option>
            <option value="bert">BERT</option>
            <option value="gpt2">GPT-2</option>
            <option value="elmo">ELMo</option>
            <option value="glove">GloVe</option>
        </select><br><br>
        <button onclick="withLoading('loader-vector-manual', applyVectorizeManual)">Vector ho√° Manual</button>
        <button onclick="withLoading('loader-vector-csv', applyVectorizeCSV)">Vector ho√° CSV</button>
        <div id="loader-vector-manual" class="loader"></div>
        <div id="loader-vector-csv" class="loader"></div>
        <div id="vector-result-manual" class="result-table-container"></div>
        <div id="csv-vector-info" style="margin-top:10px;"></div>
        <div id="csv-vector-samples" class="result-table-container" style="margin-top:10px;"></div>
    </div>

    <!-- Tab: Hu·∫•n luy·ªán m√¥ h√¨nh -->
    <div id="train" class="tab-content" style="display:none;">
        <h2>üß† Hu·∫•n luy·ªán m√¥ h√¨nh</h2>
        <p><em>S·ª≠ d·ª•ng d·ªØ li·ªáu CSV ƒë√£ ƒë∆∞·ª£c Vector ho√° (t·ª´ ph∆∞∆°ng ph√°p ƒë·∫ßu ti√™n ƒë∆∞·ª£c ch·ªçn ·ªü tab Bi·ªÉu di·ªÖn).</em></p>
        <label>Ch·ªçn m√¥ h√¨nh:</label>
        <select id="model-type" onchange="updateModelParams()">
            <option value="nb">Naive Bayes</option>
            <option value="logistic">Logistic Regression</option>
            <option value="svm">SVM</option>
            <option value="knn">KNN</option>
            <option value="tree">Decision Tree</option>
            <option value="rf">Random Forest</option>
            <option value="gb">Gradient Boosting</option> 
        </select>
        <label>T·ª∑ l·ªá Test Size (0.1-0.5):</label>
        <input type="number" id="test-size" value="0.2" min="0.1" max="0.5" step="0.05" style="width: 80px;">
        <div id="model-params"></div>
        <button onclick="withLoading('loader-train', trainFromCSV)">Train t·ª´ CSV</button>
        <div id="loader-train" class="loader"></div>
        <div id="train-result-display" style="margin-top:10px;">
            <h4>K·∫øt qu·∫£ hu·∫•n luy·ªán:</h4>
            <pre id="train-result-text"></pre>
            <div id="train-charts"></div>
        </div>
        
        <hr>
        <h3>L∆∞u v√† So s√°nh M√¥ h√¨nh</h3>
        <input type="text" id="save-model-name" placeholder="ƒê·∫∑t t√™n cho model n√†y...">
        <button onclick="saveTrainedModel()">L∆∞u Model V·ª´a Train</button>
        <br><br>
        <button onclick="withLoading('loader-compare', generateComparisonsUI)">Hi·ªán So S√°nh C√°c Model ƒê√£ L∆∞u</button>
        <div id="loader-compare" class="loader"></div>
        <div id="compare-result" style="margin-top:10px;"></div>
        <button onclick="clearAllChartsAndSavedModels()" style="background-color: #e74c3c;">Xo√° T·∫•t C·∫£ Model ƒê√£ L∆∞u & Bi·ªÉu ƒê·ªì</button>
        
        <hr>
        <h3>Ki·ªÉm tra Model ƒê√£ L∆∞u</h3>
        <label>Ch·ªçn model ƒë√£ l∆∞u:</label>
        <select id="select-test-model"></select><br>
        <textarea id="test-input-text" rows="3" cols="70" placeholder="Nh·∫≠p vƒÉn b·∫£n ƒë·ªÉ ki·ªÉm tra..."></textarea><br>
        <button onclick="predictWithSelectedModel()">D·ª± ƒëo√°n</button>
        <div id="test-predict-result" style="margin-top:10px;"></div>
    </div>

    <!-- Tab: G·ª£i √Ω s·∫£n ph·∫©m -->
    <div id="recommend" class="tab-content" style="display:none;">
        <h2>üéØ G·ª£i √Ω s·∫£n ph·∫©m (S·ª≠ d·ª•ng SVD)</h2>
        <h4>1. T·∫£i Dataset S·∫£n ph·∫©m (CSV)</h4>
        <input type="file" id="recommendCsvInput" accept=".csv">
        <button onclick="withLoading('loader-rec-upload', uploadRecommendationCSV)">T·∫£i Dataset</button>
        <div id="loader-rec-upload" class="loader"></div>
        <div id="recommend-columns-selection" style="margin-top:10px; display:none;">
            <label>C·ªôt M√¥ t·∫£ s·∫£n ph·∫©m (Keyword):</label>
            <select id="rec-keyword-col"></select><br>
            <label>C·ªôt T√™n/ID S·∫£n ph·∫©m:</label>
            <select id="rec-product-id-col"></select><br>
            <button onclick="selectRecommendColumns()">X√°c nh·∫≠n c·ªôt</button>
        </div>
        
        <div id="recommend-train-section" style="display:none;">
            <h4>2. Hu·∫•n luy·ªán m√¥ h√¨nh SVD</h4>
            <button onclick="withLoading('loader-rec-train', trainRecommendSVD)">Train SVD</button>
            <div id="loader-rec-train" class="loader"></div>
            <p id="svd-train-status"></p>
        </div>

        <div id="recommend-query-section" style="display:none;">
            <h4>3. Nh·∫≠p m√¥ t·∫£ ƒë·ªÉ t√¨m s·∫£n ph·∫©m g·ª£i √Ω</h4>
            <textarea id="recommend-text-query" rows="3" cols="70" placeholder="V√≠ d·ª•: ƒëi·ªán tho·∫°i m√†n h√¨nh l·ªõn, pin tr√¢u..."></textarea><br>
            <button onclick="withLoading('loader-rec-get', getProductRecommendations)">G·ª£i √Ω ngay</button>
            <div id="loader-rec-get" class="loader"></div>
            <div id="recommend-result-display" style="margin-top:10px;"></div>
        </div>
    </div>

    <!-- Tab: Chatbot -->
    <div id="chatbot" class="tab-content" style="display:none;">
        <h2>üí¨ Chatbots</h2>
        <div class="chatbot-container"> <!-- B·ªçc m·ªói chatbot trong m·ªôt container -->
            <h3>ü§ñ Chatbot M·∫∑c ƒë·ªãnh</h3>
            <div id="chat-log" class="chat-log-area">
                <div class="bot-message"><strong>Bot:</strong> Ch√†o b·∫°n! B·∫°n mu·ªën h·ªèi g√¨ v·ªÅ NLP ho·∫∑c ·ª©ng d·ª•ng n√†y kh√¥ng?</div>
                <!-- Placeholder cho typing indicator c·ªßa Bot M·∫∑c ƒë·ªãnh -->
                <div class="typing-indicator-container" id="default-bot-typing-indicator" style="display: none;">
                    <div class="bot-message typing-indicator">
                        <strong>Bot:</strong>
                        <div class="dot-flashing"></div>
                    </div>
                </div>
            </div>
            <div class="chat-input-area">
                <input type="text" id="chat-input" placeholder="H·ªèi Bot m·∫∑c ƒë·ªãnh..." style="width:calc(80% - 70px);">
                <button onclick="sendChatMessage()">G·ª≠i</button>
            </div>
        </div>

        <hr style="margin: 30px 0;">

        <div class="chatbot-container">
            <h3>‚ú® Gemini Chatbot</h3>
            <div id="gemini-chat-log" class="chat-log-area chat-log-gemini">
                <div class="bot-message">
                    <strong>Gemini Bot:</strong> Xin ch√†o, t√¥i l√† Gemini! B·∫°n mu·ªën h·ªèi g√¨?
                </div>
                <!-- Placeholder cho typing indicator c·ªßa Gemini Bot -->
                <div class="typing-indicator-container" id="gemini-bot-typing-indicator" style="display: none;">
                    <div class="bot-message typing-indicator">
                        <strong>Gemini Bot:</strong>
                        <div class="dot-flashing"></div>
                    </div>
                </div>
            </div>
            <div class="chat-input-area">
                <input type="text" id="gemini-chat-input" placeholder="H·ªèi Gemini..." style="width:calc(80% - 70px);">
                <button onclick="sendGeminiChatMessage()">G·ª≠i cho Gemini</button>
            </div>
        </div>
    </div>

    <script src="/static/js/marked.min.js"></script>
    <script src="/static/js/webapp.js"></script>
</body>
</html>