<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Quy tr√¨nh Thu th·∫≠p, TƒÉng c∆∞·ªùng, X·ª≠ l√Ω v√† Bi·ªÉu di·ªÖn d·ªØ li·ªáu</title>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
    <h1>Quy tr√¨nh Thu th·∫≠p, TƒÉng c∆∞·ªùng, X·ª≠ l√Ω v√† Bi·ªÉu di·ªÖn d·ªØ li·ªáu</h1>
    
    {% if error %}
    <p style="color: red;">{{ error }}</p>
    {% endif %}

    <div class="step" id="step1">
        <h2>B∆∞·ªõc 1: Thu th·∫≠p d·ªØ li·ªáu</h2>
        <form method="POST">
            <input type="hidden" name="step" value="collection">
            <label>
                <input type="radio" name="input_type" value="manual" checked onclick="toggleInputType()"> Nh·∫≠p vƒÉn b·∫£n
            </label>
            <label>
                <input type="radio" name="input_type" value="web" onclick="toggleInputType()"> L·∫•y t·ª´ S√°ch sherlock.txt
            </label>
            <div id="manual_input" style="margin-top: 10px;">
                <textarea name="manual_text" rows="5" cols="60" placeholder="Nh·∫≠p vƒÉn b·∫£n c·ªßa b·∫°n..."></textarea>
            </div>
            <div id="web_input" style="display: none; margin-top: 10px;">
                <p>Ch·ªçn "L·∫•y t·ª´ web" r·ªìi nh·∫•n Th·ª±c thi ƒë·ªÉ t·∫£i s√°ch.</p>
            </div>
            <br>
            <button type="submit">Th·ª±c thi B∆∞·ªõc 1</button>
        </form>
        <div id="collection_output">
            {{ collection_output|safe }}
        </div>
        {{ select_paragraph_form|safe }}
    </div>

    <div class="step" id="step2">
        <h2>B∆∞·ªõc 2: TƒÉng c∆∞·ªùng d·ªØ li·ªáu</h2>
        <form method="POST">
            <input type="hidden" name="step" value="augmentation">
            <p>Ch·ªçn c√°c ph∆∞∆°ng ph√°p tƒÉng c∆∞·ªùng (√°p d·ª•ng theo th·ª© t·ª±):</p>
            <label><input type="checkbox" name="augment_options" value="back_translation"> D·ªãch ng∆∞·ª£c (EN-FR-EN)</label><br>
            <label><input type="checkbox" name="augment_options" value="synonym_replacement"> Thay th·∫ø t·ª´ ƒë·ªìng nghƒ©a</label><br>
            <label><input type="checkbox" name="augment_options" value="random_insertion"> Th√™m ng·∫´u nhi√™n m·ªôt s·ªë t·ª´</label><br>
            <label><input type="checkbox" name="augment_options" value="random_swap"> ƒê·ªïi ch·ªó ng·∫´u nhi√™n m·ªôt s·ªë t·ª´</label><br>
            <label><input type="checkbox" name="augment_options" value="random_deletion"> X√≥a ng·∫´u nhi√™n m·ªôt s·ªë t·ª´</label><br>
            <label><input type="checkbox" name="augment_options" value="entity_replacement"> Thay th·∫ø th·ª±c th·ªÉ</label><br>
            <label><input type="checkbox" name="augment_options" value="add_noise"> Th√™m nhi·ªÖu</label><br>
            <br>
            <button type="submit">Th·ª±c thi B∆∞·ªõc 2</button>
        </form>
        <div id="augmentation_output">
            {{ augmentation_result|safe }}
        </div>
    </div>

    <div class="step" id="step3">
        <h2>B∆∞·ªõc 3: X·ª≠ l√Ω d·ªØ li·ªáu</h2>
        <form method="POST">
            <input type="hidden" name="step" value="processing">
            <p>Ch·ªçn c√°c ph∆∞∆°ng ph√°p ti·ªÅn x·ª≠ l√Ω (√°p d·ª•ng theo th·ª© t·ª±):</p>
            <label><input type="checkbox" name="preprocess_options" value="sentence_tokenization"> Sentence tokenization</label><br>
            <label><input type="checkbox" name="preprocess_options" value="word_tokenization"> Word tokenization</label><br>
            <label><input type="checkbox" name="preprocess_options" value="remove_stopwords"> X√≥a stop words</label><br>
            <label><input type="checkbox" name="preprocess_options" value="rm_pun"> X√≥a c√°c lo·∫°i d·∫•u</label><br>
            <label><input type="checkbox" name="preprocess_options" value="lowercasing"> Vi·∫øt th∆∞·ªùng c√°c k√Ω t·ª±</label><br>
            
            <label><input type="checkbox" name="preprocess_options" value="fix_abbreviations"> S·ª≠a l·∫°i c√°c t·ª´ vi·∫øt t·∫Øt, vi·∫øt sai</label><br>
            <label><input type="checkbox" name="preprocess_options" value="pos_tagging"> POS tagging</label><br>
            <br>
            <button type="submit">Th·ª±c thi B∆∞·ªõc 3</button>
        </form>
        <div id="processing_output">
            {{ processing_output|safe }}
        </div>
    </div>

    <div class="step" id="step4">
        <h2>B∆∞·ªõc 4: Bi·ªÉu di·ªÖn d·ªØ li·ªáu</h2>
        <form method="POST">
            <input type="hidden" name="step" value="representation">
            <p>Ch·ªçn c√°c l·ª±a ch·ªçn sau:</p>
    
            <!-- Basic Vectorization Approaches -->
            <label>
                <strong>1. Basic Vectorization Approaches</strong><small> (C√°c ph∆∞∆°ng ph√°p vector h√≥a c∆° b·∫£n)</small>
            </label>
            <ul>
                <li><input type="checkbox" name="basic_representation" value="one_hot"> One-Hot Encoding</li>
                <li><input type="checkbox" name="basic_representation" value="bow"> Bag of Words (BoW)</li>
                <li><input type="checkbox" name="basic_representation" value="ngram"> N-Grams</li>
                <li><input type="checkbox" name="basic_representation" value="tfidf"> TF-IDF</li>
            </ul>
            
            <!-- Distributed Representations -->
            <label>
                <strong>2. Distributed Representations</strong><small> (Bi·ªÉu di·ªÖn ph√¢n t√°n)</small>
            </label>
            <ul>
                <li><input type="checkbox" name="distributed_representation" value="word2vec"> Word2Vec</li>
                <li><input type="checkbox" name="distributed_representation" value="fasttext"> FastText</li>
                <li><input type="checkbox" name="distributed_representation" value="glove"> GloVe</li>
            </ul>
    
            <!-- Contextualized Representations -->
            <label>
                <strong>3. Contextualized Representation</strong><small> (Bi·ªÉu di·ªÖn ng·ªØ c·∫£nh)</small>
            </label>
            <ul>
                <li><input type="checkbox" name="contextualized_representation" value="elmo"> ELMo</li>
                <li><input type="checkbox" name="contextualized_representation" value="gpt"> GPT</li>
                <li><input type="checkbox" name="contextualized_representation" value="bert"> BERT</li>
            </ul>
    
            <br>
            <button type="submit">Th·ª±c thi B∆∞·ªõc 4</button>
        </form>
    
        <div id="representation_output">
            {{ representation_output|safe }}
        </div>
    </div>
    
    <div class="train-dataset" id="step-dataset">
        <h2>Train Dataset</h2>
        <label for="dataset-select">Ch·ªçn Dataset:</label>
        <select id="dataset-select">
            <option value="SST">SST</option>
            <option value="IMDb">IMDb Review</option>
            <option value="Yelp">Yelp Review</option>
            <option value="Amazon">Amazon Review</option>
            <option value="TREC">TREC</option>
            <option value="Yahoo">Yahoo! Answers</option>
            <option value="AG">AG's News</option>
            <option value="Sogou">Sogou News</option>
            <option value="DBPedia">DBPedia</option>
        </select>
    
        <label for="model-select">Ch·ªçn M√¥ H√¨nh:</label>
        <select id="model-select">
            <option value="knn">KNN</option>
            <option value="decision_tree">Decision Tree</option>
        </select>
    
        <button onclick="trainModel()">Train</button> <span id="loading-icon" style="display: none;">üîÑ</span>
    
        <h3>K·∫øt Qu·∫£:</h3>
        <button onclick="clearResults()">X√≥a T·∫•t C·∫£</button>
        <div id="results-container"></div> 
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", loadResults);

        function trainModel() {
            let dataset = document.getElementById("dataset-select").value;
            let model = document.getElementById("model-select").value;
            let loadingIcon = document.getElementById("loading-icon");

            loadingIcon.style.display = "inline-block";
            loadingIcon.innerHTML = "üîÑ";

            fetch('/train', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ dataset, model })
            })
            .then(response => response.json())
            .then(data => {
                loadingIcon.innerHTML = "‚úî";
                addResultToUI(data);
            })
            .catch(error => {
                console.error('Error:', error);
                loadingIcon.innerHTML = "‚ùå";
            });
        }

        function loadResults() {
            fetch('/results')
            .then(response => response.json())
            .then(results => {
                console.log('D·ªØ li·ªáu results:', results); // Xem d·ªØ li·ªáu t·ª´ server
                document.getElementById("results-container").innerHTML = "";
                results.forEach((result, index) => {
                    console.log('result:', result, 'index:', index); // Xem t·ª´ng c·∫∑p result-index
                    addResultToUI(result, index);
                });
            })
            .catch(error => console.error('L·ªói:', error));
        }

        
        function addResultToUI(result, index) {
            let container = document.getElementById("results-container");
            let div = document.createElement("div");
            div.classList.add("result-item");

            let formattedResult = `
                <strong>Dataset:</strong> ${result.dataset} <br>
                <strong>Model:</strong> ${result.model} <br>
                <strong>Accuracy:</strong> ${result.accuracy} <br>
                <strong>Report:</strong> <pre>${result.report}</pre>
            `;

            div.innerHTML = `
                <div class="result-box">${formattedResult}</div>
                <button onclick="deleteResult(${index})">X√≥a</button>
            `;
            container.appendChild(div);
        }

        function deleteResult(index) {
            console.log('G·ª≠i index:', index);
            fetch('/delete_result', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ index: index })  // G·ª≠i index c·∫ßn x√≥a
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('L·ªói x√≥a k·∫øt qu·∫£: ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                // Ki·ªÉm tra xem data.results c√≥ t·ªìn t·∫°i v√† l√† m·∫£ng kh√¥ng
                if (data && Array.isArray(data.results)) {
                    const container = document.getElementById("results-container");
                    container.innerHTML = ""; // X√≥a UI c≈©
                    data.results.forEach((result, i) => addResultToUI(result, i)); // Render l·∫°i to√†n b·ªô
                } else {
                    console.warn('Kh√¥ng c√≥ k·∫øt qu·∫£ n√†o ƒë·ªÉ hi·ªÉn th·ªã sau khi x√≥a.');
                    document.getElementById("results-container").innerHTML = "<p>Kh√¥ng c√≤n k·∫øt qu·∫£ n√†o.</p>";
                }
            })
            .catch(error => {
                console.error('L·ªói:', error);
                alert('ƒê√£ x·∫£y ra l·ªói khi x√≥a k·∫øt qu·∫£!');
            });
        }


        function clearResults() {
            fetch('/clear_results', { method: 'POST' })
            .then(() => loadResults());
        }

        function toggleInputType() {
            var manual = document.querySelector('input[value="manual"]').checked;
            document.getElementById('manual_input').style.display = manual ? 'block' : 'none';
            document.getElementById('web_input').style.display = manual ? 'none' : 'block';
        }
    </script>
</body>
</html>